<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sungjin.jobfair.service.UserMapper">

    <!--**************************************************로그인 관련**************************************************-->
        <!--로그인시 비밀번호 같은지 비교-->
    <select id = "getEncodePw" resultType="String" parameterType="UserVO">
        select user_pw from User where user_id = #{user_id}
    </select>
        <!--로그인-->
    <select id="login" resultType="UserVO">
        select *
        from User
        where user_id = #{user_id}
    </select>

        <!--유저정보 불러오기-->
    <select id="info" resultType="UserVO">
        select *
        from User
        where user_id = #{id}
    </select>


    <!--**************************************************Q&A**************************************************-->
        <!--유저 큐앤에이 등록-->
    <insert id="qnaRegist" parameterType="QnAVO">
        insert into QnA(user_id, qa_title, qa_content, qa_regDate, qa_type, com_num)
        values (#{user_id}, #{qa_title}, #{qa_content}, date_format(now(), '%Y-%m-%d') , #{qa_type}, #{com_num})
    </insert>
    <!--유저 큐앤에이 리스트-->
    <select id="getQnAList" resultType="QnAVO">
        select *
        from QnA
        where qa_type like "%q%"
        order by qa_num desc limit #{pageStart}, #{amount}
    </select>


<!--    <select id="getPage" resultType="QnAVO">-->
<!--        select * from qna-->
<!--        order by qa_num desc limit #{pageStart}, #{amount}-->
<!--    </select>-->


        <!--큐앤에이 상세페이지-->
    <select id="getQnADetail" resultType="QnAVO">
        select *
        from QnA
        where qa_num = #{qa_num}
    </select>
        <!--큐앤에이 수정-->
    <update id="uQnAModi" parameterType="QnAVO">
        update QnA set qa_title = #{qa_title} , qa_content = #{qa_content}
        where qa_num = #{qa_num}
    </update>

<!--    <select id="uQnABtnClick" resultType="QnAVO">-->
<!--        select * from qna where com_num like '%3%'-->
<!--    </select>-->


    <!--**************************************************채용공고**************************************************-->
        <!--채용공고 리스트-->
    <select id="getJobPostList" resultType="EmpVO">
        select *
        from jobpostinglist j
                 left join company c on j.com_num = c.com_num
        order by jpl_num desc
    </select>
        <!--채용공고 상세검색-->
    <select id="getJobPostSrc" resultType="EmpVO">

        select  * from jobpostinglist j  left join company c on j.com_num = c.com_num where 1 = 1

        <if test="jpl_locationSi.length != 0">
            and jpl_locationSi in
            <foreach item="jpl_locationSi" index="index" collection="jpl_locationSi"
                     open="(" separator="," close=")">
                #{jpl_locationSi}
            </foreach>
        </if>

        <if test="jpl_locationGu.length != 0">
            and jpl_locationGu in
            <foreach item="jpl_locationGu" index="index" collection="jpl_locationGu"
                     open="(" separator="," close=")">
                #{jpl_locationGu}
            </foreach>
        </if>

        <if test="jpl_duty.length != 0">
            and jpl_duty in
            <foreach item="jpl_duty" index="index" collection="jpl_duty"
                     open="(" separator="," close=")">
                #{jpl_duty}
            </foreach>
        </if>

        <if test="jpl_workHistory.length != 0">
            and jpl_workHistory in
            <foreach item="jpl_workHistory" index="index" collection="jpl_workHistory"
                     open="(" separator="," close=")">
                #{jpl_workHistory}
            </foreach>
        </if>

        <if test="jpl_education.length != 0">
            and jpl_education in
            <foreach item="jpl_education" index="index" collection="jpl_education"
                     open="(" separator="," close=")">
                #{jpl_education}
            </foreach>
        </if>

        <if test="jpl_salary.length != 0">
            and jpl_salary in
            <foreach item="jpl_salary" index="index" collection="jpl_salary"
                     open="(" separator="," close=")">
                #{jpl_salary}
            </foreach>
        </if>

        <if test="jpl_certificate.length != 0">
            and jpl_certificate in
            <foreach item="jpl_certificate" index="index" collection="jpl_certificate"
                     open="(" separator="," close=")">
                #{jpl_certificate}
            </foreach>
        </if>

        <if test="jpl_conditions.length != 0">
            and jpl_conditions in
            <foreach item="jpl_conditions" index="index" collection="jpl_conditions"
                     open="(" separator="," close=")">
                #{jpl_conditions}
            </foreach>
        </if>

        <if test="jpl_workForm.length != 0">
            and jpl_workForm in
            <foreach item="jpl_workForm" index="index" collection="jpl_workForm"
                     open="(" separator="," close=")">
                #{jpl_workForm}
            </foreach>
        </if>

       <if test="inputSearch != ''">
            and jpl_title like
           concat('%', #{inputSearch}, '%') or
           com_name like
           concat('%', #{inputSearch}, '%')


        </if>

    </select>

    <!--채용공고 지원하기-->
    <insert id="EmpApply">
        INSERT INTO
            applylist (user_id, jpl_num, res_num, al_state)
        VALUES (#{user_id}, #{jpl_num}, #{res_num}, "X")
    </insert>
    <!--유저가 지원한 공고인지 찾기-->
    <select id="EmpApplied" resultType="int">
        select EXISTS (select * from applylist where user_id=#{user_id} and jpl_num = #{jpl_num} limit 1) as success;
    </select>

    <!--**************************************************마이페이지 이력서**************************************************-->
        <!--이력서정보-->
    <select id="resumeInfo" resultType="ResumeVO">
        select * from ResumeList where user_id = #{user_id}
    </select>
        <!--이력서 지우기-->
    <delete id="deleteResume">
        delete from ResumeList where res_num = #{res_num}
    </delete>





    <!--**************************************************이력서 관련**************************************************-->
        <!--이력서 등록-->
    <insert id="regResume" parameterType="ResumeVO" useGeneratedKeys="true" keyProperty="res_num" keyColumn="res_num">
        insert into ResumeList (user_id, res_title, res_content, res_regDate,
                                res_picName, res_picPath, res_picUuid, res_name, res_email,
                                res_phone, res_address, res_birth)
        values (#{user_id}, #{res_title}, #{res_content}, date_format(now(), '%Y-%m-%d'),
                #{res_picName}, #{res_picPath}, #{res_picUuid}, #{res_name}, #{res_email},
                #{res_phone}, #{res_address}, #{res_birth})
    </insert>

        <!--이력서 학력등록-->
    <insert id="regResEdu" parameterType="EduVO">
        insert into Education (res_num, user_id, edu_degree, edu_schoolName, edu_major, edu_entranceDate,
                               edu_graduationDate,
                               edu_state, edu_grades, edu_totalGrades)
        values (#{res_num}, #{user_id}, #{edu_degree}, #{edu_schoolName}, #{edu_major}, #{edu_entranceDate},
                #{edu_graduationDate}, #{edu_state}, #{edu_grades}, #{edu_totalGrades})
    </insert>
        <!--이력서 경력등록-->
    <insert id="regResWe" parameterType="WeVO">
        insert into WorkExperiences (res_num, user_id, we_company, we_department, we_position, we_job, we_emplDate,
                                     we_departureDate, we_salary)
        values (#{res_num}, #{user_id}, #{we_company}, #{we_department}, #{we_position}, #{we_job}, #{we_emplDate},
                #{we_departureDate}, #{we_salary})
    </insert>
        <!--이력서 자격증 등록-->
    <insert id="regResCert" parameterType="CertVO">
        insert into Certificate (res_num, user_id, cert_name, cert_gainDate, cert_issueInstitute)
        values (#{res_num}, #{user_id}, #{cert_name}, #{cert_gainDate}, #{cert_issueInstitute})
    </insert>


    <!--**************************************************페이지네이션**************************************************-->
<!--    <select id="getQnATotal" resultType="int">-->
<!--        select count(*) from qna-->
<!--    </select>-->


    <!--페이지네이션-->
    <select id="uQnAGetTotal" resultType="int">
        select count(*) from qna
    </select>




</mapper>

